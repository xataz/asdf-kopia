#!/usr/bin/env bash

set \
  -o nounset \
  -o pipefail \
  -o errexit

readonly VER_REGEX='v((0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)|(0|[1-9][0-9]*)\.(0|[1-9][0-9]*)\.(0|[1-9][0-9]*-.*))'

get_git_tags () {
  local -r repo_url="$1"

  local tag
  git ls-remote --tags "${repo_url}" | awk '{print $2}' | sed -e 's#refs/tags/##' -e 's#\^{}##' -e 's#v##' | sort -u | sort -t '.' -k 1,1n -k 2,2n
}

list_all () {
  get_git_tags "https://github.com/kopia/kopia" | tr -s ' ' | sed "s/v//"
}

list_all